# PRD: Упрощение приложения и устранение пользовательских барьеров

## 1. Введение
Настоящий документ описывает стратегию по упрощению мобильного приложения CyberVPN. Основная цель — устранение избыточных проверок и функциональных элементов, которые создают препятствия для пользователей, усложняют поддержку и увеличивают вероятность сбоев.

## 2. Проблема
В текущей версии приложения реализованы функции, которые:
- Ограничивают использование приложения на специфических устройствах (Root/Jailbreak).
- Требуют избыточных системных разрешений (Камера для QR, Местоположение для SSID).
- Создают дополнительные точки отказа из-за зависимости от сторонних библиотек и аппаратных компонентов.
- Увеличивают объем входящих тикетов в поддержку из-за блокировок или ошибок доступа.

## 3. Цели
1. **Снижение барьера входа**: Пользователь должен иметь возможность запустить VPN с минимальным количеством кликов и разрешений.
2. **Повышение стабильности**: Уменьшение зависимости от "хрупких" аппаратных функций (камера, датчики) и специфических API ОС.
3. **Упрощение поддержки**: Устранение целых категорий ошибок (например, "приложение не запускается на моем root-устройстве").

## 4. Ключевые изменения

### 4.1. Удаление проверки Root/Jailbreak
- **Что сделать**: Полностью удалить библиотеку `flutter_jailbreak_detection` и все связанные с ней проверки в `DeviceIntegrityChecker`.
- **Обоснование**: В регионах с жесткой цензурой пользователи часто используют root для обхода блокировок на системном уровне. Блокировка таких пользователей или даже предупреждение их — это барьер, который не дает реальной безопасности в контексте VPN, но создает негативный опыт.
- **Результат**: Приложение работает на любых устройствах без лишних диалогов.

### 4.2. Оптимизация импорта конфигураций (QR-коды)
- **Что сделать**: Сделать сканирование через камеру вторичным способом импорта. Основной фокус — на вставку ссылки из буфера обмена или автоматическое обнаружение ссылки.
- **Обоснование**: Камера может быть повреждена, разрешения могут быть отклонены, или QR-код может плохо читаться. Это частая причина "затыков" при настройке.
- **Результат**: Пользователь может настроить VPN, даже если у него нет рабочей камеры или он не хочет давать ей доступ.

### 4.3. Минимизация системных разрешений
- **Что сделать**: 
    - Удалить обязательный запрос разрешения на Местоположение (необходим для SSID WiFi). 
    - Функцию "Доверенные WiFi" сделать строго опциональной: запрос разрешения происходит только при активации функции пользователем глубоко в настройках.
    - Пересмотреть экран Onboarding Permissions, оставив только критически важное (VPN Config).
- **Обоснование**: Запрос местоположения в VPN-приложении вызывает подозрение у пользователей, заботящихся о приватности.
- **Результат**: Повышение доверия пользователей и упрощение процесса установки.

## 5. Технический план (Flutter)
1. Очистка `pubspec.yaml` от `flutter_jailbreak_detection`.
2. Рефакторинг `lib/core/security/device_integrity.dart` (замена на заглушки или полное удаление).
3. Удаление `RootWarningBanner` и `RootDetectionDialog`.
4. Изменение логики в `PermissionRequestScreen`: оставить только запрос на создание VPN-туннеля.
5. Вынос логики `mobile_scanner` в отдельный опциональный модуль или замена на текстовый ввод по умолчанию.

## 6. Метрики успеха
- Снижение количества обращений в поддержку на 20% в категории "Настройка и запуск".
- Увеличение конверсии из установки в первое подключение.
- Уменьшение размера сборки (за счет удаления нативных зависимостей).
- Отсутствие ошибок, связанных с `Permission Denied` на этапе онбординга.
