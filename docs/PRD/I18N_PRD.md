# PRD: Исправление и Стандартизация Интернационализации (I18N) в CyberVPN Mobile

**Дата:** 7 февраля 2026
**Статус:** Draft
**Приоритет:** Medium
**Автор:** Gemini CLI (Assistant)

## 1. Обзор
Данный документ описывает план устранения ошибок локализации и стандартизации процесса работы с переводами в проекте `cybervpn_mobile`.
На текущий момент в проекте наблюдается значительная рассинхронизация между базовым файлом перевода (`app_en.arb`) и остальными 25+ языками, а также наличие захардкоженных строк в UI-компонентах.

## 2. Анализ Текущего Состояния (Findings)

### 2.1. Рассинхронизация ARB-файлов
*   **Симптом:** Ошибка `untranslated message(s)` для 25+ локалей (ar, cs, da, de, es, fa, fr, hi, ru, ja, ko, zh и др.).
*   **Причина:** Шаблонный файл `app_en.arb` содержит ~1590 ключей, в то время как другие файлы (например, `app_ru.arb`) содержат ~1280 ключей. 
*   **Критическое расхождение:** Недавно добавленные ключи для функционала авторизации и биометрии отсутствуют во всех языках, кроме английского:
    *   `loginTitle`, `loginSubtitle`
    *   `loginBiometricFaceId`, `loginBiometricFingerprint`
    *   `loginOrSeparator`, `loginOrUsePassword`
    *   `appLock*` (весь блок ключей для защиты приложения)

### 2.2. Захардкоженные строки в коде
В ходе анализа выявлено множество строк, которые не вынесены в ARB файлы. Примеры:
*   **LoginScreen:**
    *   `'Your password has changed. Please sign in with your password.'`
    *   `'Your biometric settings have changed. Please sign in with your password and re-enable...'`
    *   `'Sign in to CyberVPN'` (причина для биометрической аутентификации)
*   **RegisterScreen:** Тексты ошибок и подтверждений в SnackBar.
*   **Main.dart:** Сообщения об ошибках инициализации сервисов.

## 3. Технические Требования (Fix Plan)

### 3.1. Синхронизация ARB файлов
Необходимо обеспечить наличие всех ключей из `app_en.arb` во всех остальных файлах локализации.

**Действия:**
1.  **Автоматическое заполнение:** Для отсутствующих ключей использовать английское значение как временную заглушку (fallback), чтобы сборка проходила без ошибок.
2.  **Процесс перевода:** Передать список из ~310 недостающих ключей (включая 20 критических для Onboarding/Auth) на перевод.
3.  **Валидация:** Добавить в CI шаг проверки `flutter gen-l10n` с флагом строгости (или проверку на наличие всех ключей).

### 3.2. Устранение Hardcoded Strings
Все строковые литералы, отображаемые пользователю, должны быть перенесены в `lib/core/l10n/arb/app_en.arb`.

**Ключевые зоны для исправления:**
1.  `lib/features/auth/presentation/screens/login_screen.dart`
2.  `lib/features/auth/presentation/screens/register_screen.dart`
3.  `lib/features/onboarding/presentation/screens/onboarding_screen.dart`
4.  `lib/features/onboarding/presentation/screens/permission_request_screen.dart`

### 3.3. Использование Placeholder и Plurals
Для динамических строк (например, "Failed attempts: {count}") необходимо использовать синтаксис ARB с плейсхолдерами вместо конкатенации строк в Dart.

## 4. План Реализации (Tasks)

### Задача 1: Анализ и Экспорт недостающих ключей
*   **Действие:** Выполнить скрипт сравнения `app_en.arb` с другими языками и составить JSON-список отсутствующих ключей для каждого языка.
*   **Результат:** Файл `missing_translations.json`.

### Задача 2: Обработка Hardcoded Strings
*   **Действие:** Пройти по списку файлов (Auth, Onboarding) и заменить строковые литералы на `AppLocalizations.of(context).key`.
*   **Пример:**
    *   *Было:* `Text('Login to your account')`
    *   *Стало:* `Text(l10n.loginTitle)`

### Задача 3: Создание заглушек для CI
*   **Действие:** Написать скрипт, который копирует отсутствующие ключи из `app_en.arb` в другие файлы с пометкой `TODO` или префиксом `[EN]`, чтобы восстановить работоспособность `gen-l10n`.

## 5. Использованные Skills & Best Practices

*   **flutter-internationalization:**
    *   Следование структуре `l10n.yaml`.
    *   Использование `template-arb-file` как эталона.
    *   Применение описаний (`@key`) для контекста переводчиков.
*   **i18n-expert:**
    *   Замена жестко заданных строк на вызовы из контекста.
    *   Обеспечение поддержки RTL для арабского и иврита (проверка `Directionality`).

## 6. Критерии Приемки (Definition of Done)
1.  [ ] Команда `flutter gen-l10n` выполняется без предупреждений `untranslated message(s)`.
2.  [ ] Все новые экраны (Auth, Onboarding) не содержат жестко заданных строк на английском или русском в Dart коде.
3.  [ ] При переключении языка в настройках приложения все элементы Onboarding и Auth корректно меняют язык.
4.  [ ] Для языков с RTL (ar, he, fa) интерфейс отображается корректно (отзеркален).
